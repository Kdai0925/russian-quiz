<!DOCTYPE html>
<html lang="ja">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ğŸ‡¯ğŸ‡µâ†”ğŸ‡·ğŸ‡º ãƒ­ã‚·ã‚¢èªã‚¯ã‚¤ã‚º</title>

<style>

body{
font-family:-apple-system,BlinkMacSystemFont,"Segoe UI";
background:#f2f2f7;
margin:0;
padding:20px;
}

.container{
background:white;
padding:20px;
border-radius:15px;
box-shadow:0 4px 15px rgba(0,0,0,0.15);
max-width:500px;
margin:auto;
}

button{
font-size:18px;
padding:12px;
margin:5px;
border:none;
border-radius:10px;
background:#317EFB;
color:white;
width:100%;
}

input{
font-size:20px;
padding:10px;
width:100%;
margin:10px 0;
}

.keyboard button{
width:11%;
margin:1%;
padding:8px;
font-size:16px;
}

.word-item{
display:flex;
justify-content:space-between;
margin:5px 0;
}

.menu button{
width:48%;
}

</style>

</head>
<body>

<div class="container">

<h2>ğŸ‡¯ğŸ‡µâ†”ğŸ‡·ğŸ‡º ãƒ­ã‚·ã‚¢èªã‚¯ã‚¤ã‚º</h2>

<div class="menu">

<button onclick="showAdd()">å˜èªè¿½åŠ </button>
<button onclick="showList()">å˜èªä¸€è¦§</button>
<button onclick="startQuiz('jp')">æ—¥â†’éœ²</button>
<button onclick="startQuiz('ru')">éœ²â†’æ—¥</button>

</div>

<div id="content"></div>

</div>

<script>

// =====================
// ãƒ‡ãƒ¼ã‚¿ä¿å­˜
// =====================

let words = JSON.parse(localStorage.getItem("words") || "{}");
let mistakes = JSON.parse(localStorage.getItem("mistakes") || "{}");

function saveWords(){
localStorage.setItem("words", JSON.stringify(words));
}

function saveMistakes(){
localStorage.setItem("mistakes", JSON.stringify(mistakes));
}

// =====================
// å˜èªè¿½åŠ 
// =====================

function showAdd(){

content.innerHTML=`

<input id="jp" placeholder="æ—¥æœ¬èª">

<input id="ru" placeholder="ãƒ­ã‚·ã‚¢èª">

<button onclick="addWord()">ä¿å­˜</button>

`;

}

function addWord(){

let jp=document.getElementById("jp").value;
let ru=document.getElementById("ru").value;

if(!jp||!ru)return;

words[jp]={

ru:ru,
level:0,
correct:0,
wrong:0

};

saveWords();

alert("ä¿å­˜ã—ã¾ã—ãŸ");

}

// =====================
// å˜èªä¸€è¦§
// =====================

function showList(){

let html="";

for(let jp in words){

let w=words[jp];

html+=`
<div class="word-item">
<span>${jp} â†’ ${w.ru} (Lv.${w.level})</span>
<button onclick="deleteWord('${jp}')">å‰Šé™¤</button>
</div>
`;

}

content.innerHTML=html;

}

function deleteWord(jp){

delete words[jp];

saveWords();

showList();

}

// =====================
// é‡ã¿ä»˜ãé¸æŠ
// =====================

function weightedChoice(){

let pool=[];

for(let jp in words){

let level=words[jp].level;

let weight=5-level;

for(let i=0;i<weight;i++)
pool.push(jp);

}

return pool[Math.floor(Math.random()*pool.length)];

}

// =====================
// ã‚¯ã‚¤ã‚º
// =====================

let current;
let mode;

function startQuiz(m){

if(Object.keys(words).length<4){

alert("å˜èªã‚’4ã¤ä»¥ä¸Šç™»éŒ²ã—ã¦ãã ã•ã„");

return;

}

mode=m;

nextQuestion();

}

function nextQuestion(){

let jp=weightedChoice();

current={

jp:jp,
ru:words[jp].ru

};

if(mode=="jp"){

content.innerHTML=`

<h3>${jp}</h3>

<input id="answer">

<button onclick="check()">å›ç­”</button>

<div id="keyboard"></div>

`;

createKeyboard();

}

else{

let choices=[jp];

let keys=Object.keys(words);

while(choices.length<4){

let fake=keys[Math.floor(Math.random()*keys.length)];

if(!choices.includes(fake))
choices.push(fake);

}

choices.sort(()=>Math.random()-0.5);

let buttons="";

choices.forEach(c=>{

buttons+=`<button onclick="checkChoice('${c}')">${c}</button>`;

});

content.innerHTML=`

<h3>${current.ru}</h3>

${buttons}

`;

}

}

// =====================
// å›ç­”ãƒã‚§ãƒƒã‚¯
// =====================

function check(){

let ans=document.getElementById("answer").value;

if(ans==current.ru){

alert("æ­£è§£");

words[current.jp].correct++;

if(words[current.jp].level<4)
words[current.jp].level++;

}

else{

alert("ä¸æ­£è§£ æ­£è§£ï¼š"+current.ru);

words[current.jp].wrong++;

if(words[current.jp].level>0)
words[current.jp].level--;

mistakes[current.jp]=(mistakes[current.jp]||0)+1;

saveMistakes();

}

saveWords();

nextQuestion();

}

function checkChoice(ans){

if(ans==current.jp){

alert("æ­£è§£");

words[current.jp].correct++;

if(words[current.jp].level<4)
words[current.jp].level++;

}

else{

alert("ä¸æ­£è§£ æ­£è§£ï¼š"+current.jp);

words[current.jp].wrong++;

if(words[current.jp].level>0)
words[current.jp].level--;

mistakes[current.jp]=(mistakes[current.jp]||0)+1;

saveMistakes();

}

saveWords();

nextQuestion();

}

// =====================
// ã‚­ãƒªãƒ«ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰
// =====================

function createKeyboard(){

let letters="Ğ°Ğ±Ğ²Ğ³Ğ´ĞµÑ‘Ğ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰Ñ‹ÑŒÑÑÑ";

let html="<div class='keyboard'>";

for(let l of letters){

html+=`<button onclick="typeLetter('${l}')">${l}</button>`;

}

html+="</div>";

keyboard.innerHTML=html;

}

function typeLetter(l){

answer.value+=l;

}

// =====================

</script>

</body>
</html>