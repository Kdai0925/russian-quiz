<!DOCTYPE html>
<html lang="ja">
<head>

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>ãƒ­ã‚·ã‚¢èªã‚¯ã‚¤ã‚º</title>

<link rel="apple-touch-icon" href="icon-192.png">
<link rel="manifest" href="manifest.json">

<style>

body{
 font-family:sans-serif;
 margin:20px;
 background:#f2f2f7;
}

button{
 margin:5px;
 padding:10px;
 font-size:16px;
}

input{
 padding:10px;
 font-size:16px;
 margin:5px;
}

.card{
 background:white;
 padding:15px;
 margin:10px;
 border-radius:10px;
 box-shadow:0 0 5px rgba(0,0,0,0.2);
}

</style>

</head>
<body>

<h2>ğŸ‡¯ğŸ‡µâ†”ğŸ‡·ğŸ‡º ãƒ­ã‚·ã‚¢èªã‚¯ã‚¤ã‚ºï¼ˆå®Œå…¨ç‰ˆï¼‰</h2>

<button onclick="showMenu('add')">å˜èªè¿½åŠ </button>
<button onclick="showMenu('list')">å˜èªä¸€è¦§</button>
<button onclick="showMenu('jp_ru')">æ—¥â†’éœ²</button>
<button onclick="showMenu('ru_jp')">éœ²â†’æ—¥</button>
<button onclick="exportWords()">ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
<input type="file" onchange="importWords(event)">

<div id="app"></div>

<script>

// =====================
// ãƒ‡ãƒ¼ã‚¿
// =====================

let words = JSON.parse(localStorage.getItem("words") || "{}");

function saveWords(){
 localStorage.setItem("words", JSON.stringify(words));
}

// =====================
// ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—æ©Ÿèƒ½
// =====================

function exportWords(){

 let data = JSON.stringify(words, null, 2);

 let blob = new Blob([data], {type:"application/json"});

 let url = URL.createObjectURL(blob);

 let a = document.createElement("a");
 a.href = url;
 a.download = "words_backup.json";
 a.click();

}

function importWords(event){

 let file = event.target.files[0];

 let reader = new FileReader();

 reader.onload = function(){

  words = JSON.parse(reader.result);

  saveWords();

  alert("å¾©å…ƒå®Œäº†");

 };

 reader.readAsText(file);

}

// =====================
// ãƒ¡ãƒ‹ãƒ¥ãƒ¼
// =====================

function showMenu(menu){

 let app = document.getElementById("app");

 if(menu=="add"){

  app.innerHTML=`

<div class="card">

æ—¥æœ¬èª<br>
<input id="jp"><br>

ãƒ­ã‚·ã‚¢èª<br>
<input id="ru"><br>

<button onclick="addWord()">ä¿å­˜</button>

</div>

`;

 }

 if(menu=="list"){

  let html="<div class='card'>";

  for(let jp in words){

   html+=jp+" : "+words[jp].ru+
   " Lv."+words[jp].level+
   "<br>";

  }

  html+="</div>";

  app.innerHTML=html;

 }

 if(menu=="jp_ru"){
  newQuestion("jp_ru");
 }

 if(menu=="ru_jp"){
  newQuestion("ru_jp");
 }

}

// =====================
// å˜èªè¿½åŠ 
// =====================

function addWord(){

 let jp=document.getElementById("jp").value;
 let ru=document.getElementById("ru").value;

 words[jp]={

  ru:ru,
  level:0,
  correct:0,
  wrong:0

 };

 saveWords();

 alert("ä¿å­˜");

}

// =====================
// é‡ã¿ä»˜ãé¸æŠ
// =====================

function weightedChoice(){

 let pool=[];

 for(let jp in words){

  let weight=5-words[jp].level;

  for(let i=0;i<weight;i++){
   pool.push(jp);
  }

 }

 return pool[Math.floor(Math.random()*pool.length)];

}

// =====================
// å•é¡Œ
// =====================

let currentJP="";
let mode="";

function newQuestion(m){

 mode=m;

 currentJP=weightedChoice();

 let ru=words[currentJP].ru;

 let app=document.getElementById("app");

 if(m=="jp_ru"){

  app.innerHTML=`

<div class="card">

å•é¡Œ: ${currentJP}<br>

<input id="answer"><br>

<div id="keyboard"></div>

<button onclick="checkAnswer()">å›ç­”</button>

</div>

`;

 showKeyboard();

 }

 if(m=="ru_jp"){

  let choices=[currentJP];

  let keys=Object.keys(words);

  while(choices.length<4){

   let fake=keys[Math.floor(Math.random()*keys.length)];

   if(!choices.includes(fake)){
    choices.push(fake);
   }

  }

  choices.sort(()=>Math.random()-0.5);

  let html=`<div class="card">

å•é¡Œ: ${ru}<br>

`;

  for(let c of choices){

   html+=`<button onclick="selectAnswer('${c}')">${c}</button><br>`;

  }

  html+="</div>";

  app.innerHTML=html;

 }

}

// =====================
// ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰
// =====================

function showKeyboard(){

 let letters="Ğ°Ğ±Ğ²Ğ³Ğ´ĞµÑ‘Ğ¶Ğ·Ğ¸Ğ¹ĞºĞ»Ğ¼Ğ½Ğ¾Ğ¿Ñ€ÑÑ‚ÑƒÑ„Ñ…Ñ†Ñ‡ÑˆÑ‰Ñ‹ÑŒÑÑÑ";

 let html="";

 for(let l of letters){

  html+=`<button onclick="addLetter('${l}')">${l}</button>`;

 }

 document.getElementById("keyboard").innerHTML=html;

}

function addLetter(l){

 let input=document.getElementById("answer");

 input.value+=l;

}

// =====================
// å›ç­”
// =====================

function checkAnswer(){

 let ans=document.getElementById("answer").value;

 let correct=words[currentJP].ru;

 judge(ans,correct);

}

function selectAnswer(ans){

 let correct=currentJP;

 judge(ans,correct);

}

function judge(ans,correct){

 if(ans.trim().toLowerCase()==correct.toLowerCase()){

  alert("æ­£è§£");

  words[currentJP].correct++;

  if(words[currentJP].level<4){
   words[currentJP].level++;
  }

 }

 else{

  alert("ä¸æ­£è§£ æ­£è§£:"+correct);

  words[currentJP].wrong++;

  if(words[currentJP].level>0){
   words[currentJP].level--;
  }

 }

 saveWords();

 newQuestion(mode);

}

// =====================
// åˆæœŸè¡¨ç¤º
// =====================

showMenu("add");

</script>

</body>
</html>
